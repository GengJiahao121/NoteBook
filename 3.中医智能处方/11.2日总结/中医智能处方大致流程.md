# 中医智能处方的整体流程

## 任务类型：

**输入：包括症状和个体特征**

其中症状的输入可以是：
1. 症状集合的形式（症状1、症状2、... ...） 
2. 症状描述的序列的形式（一段话）

个体特征的输入可以是：
1. 个体特征集合（特征1、特征2、... ...） 
2. 个体特征描述的（一段话）
3. 面部特征、脉搏信号等识别出个体特征、舌诊等图片信息

总而言之，输入应同时包括症状和个体特征。因为在中医中,病患的体质是诊疗过程中需要考虑的重要因素。

**输出：对应的中药的集合。（这个集合是没有先后顺序而言的，可以理解为每一味中药作用大小都是相等的）**

## 处方的整体流程大致可以分为一下几个模块：

### 1 输入特征嵌入阶段，将输入转化为模型可以用的向量

特征嵌入有以下几种方式：

1、 简单词嵌入的方式大概的流程如下：

例如：

输入症状结合为（症状1、症状2、症状3、症状4）模型对应的输出中药为（中药1、中药2、中药3、中药4、中药5、中药6）

    第一步：分别从事先建立好的症状词典和中药词典中查找他们对应的数字索引
    
    第二步：将对应的症状和中药转换为对应的数字索引

    转换好以后就变成：10 11 12 1  ｜  23 15 24 9 25 14 

    第三步：根据对应的id从事先预训练的词嵌入模型中（word2vector/Glove/FastText等方法）取出对应的词向量

        关于预训练词嵌入模型是怎么训练出来的，可以理解为原来词典中国有1000个词，如果用[1,0,0,0,0, ... ... ][0,1,0,0,0,0,... ... ],[0,0,1,0,0,... ...]这么表示的需要1000维，但是我通过word2vector等方法可以指定它的表示维度并且还有让他具备一定的相对位置信息。总而言之，是一种简单的词嵌入的方法，选一个好用的直接拿来用就可以了。

        最终就转换成了：[症状向量1][向量2][向量3][向量4] | [中药向量1][向量2][向量3][向量4][向量5][向量6]

这样嵌入的优缺点：
   1. 词嵌入优点：简单高效 领域无关 数据量小的话可能更好
   2. 词嵌入缺点：上下文信息有限 无法处理复杂实体 词义消歧困难（所以说图神经网络的作用就是嵌入上下文信息、更精确表示复杂实体、词义消歧，嵌入上下文信息（指的是同质异质图）后，直接进行预测了）

2、 使用经过中医领域预训练过的BERT模型进行一个 具有 语义信息的嵌入

BERT好比是一个事先读过好多中医方面的书的一个模型。

使用bert嵌入后的向量带有 上下文的结构 和 语义 信息。相比简单的领域无关的词嵌入具备了一定的语义信息。

嵌入过程：

输入的文字->对应的id->词嵌入转换为词向量->(位置嵌入等)->BERT->最后的嵌入向量

### 进一步的处理

1、 图结构嵌入

无论是中药-中药图、症状-中药图、还是中药-中药图、还是具有更多实体和属性信息的知识图谱，都是图结构

每个实体的向量表示已经有了，接下来就是通过图结构来进行实体间信息的交换，可以理解为这样交换后实体向量就嵌入了图结构信息

图结构嵌入的方法：

1. 博士论文的方法（GCN/GAT方法）：构建所有症状-所有症状图、所有中药-所有中药图、所有症状-所有中药图，分别通过相同结构不同参数的GCN/GAT进行邻居节点的信息交换，每个图都会得到经过图嵌入的向量，再将不同图得到的向量进行融合得到嵌入三个图结构信息的向量。

    得到嵌入图结构信息所有症状向量和所有中药向量后，在预测时，输入症状集合，就把对应的症状表示向量从所有症状表示向量中拿出来，与所有的中药向量做进一步操作得到概率值，通过设定阀值取得前n个中药作为预测的中药集合。

2. 图对比学习方法：也是图结构嵌入的一种方法

    输入一个图结构，再准备两个图结构（一个正样例、一个负样例），输入图结构经过转换后，与正负样例计算损失（原则就是与正样例的损失越小越好，与负样例的损失越大越好，就是梯度更新的方向不一样，一个缩小、一个放大）

    具体的方法，还不太了解，原理是这样的。

### 证候/证型归纳阶段

这个阶段就是将输入症状和个体特征通过某种变换，转换为证型级别的向量

具体怎么转换的：
    通过将经过图嵌入的向量或者语义嵌入的向量融合，再一个前馈的全连接神经过网络或者多层感知机等方法做一个变换，得到证候级别的表示。

### 预测方药阶段

通过得到的证候级别的表示，预测出对应的中药集合

### 总而言之

处方的处理流程大概分为：输入的表示阶段、图结构信息的嵌入阶段、向量的融合与转换阶段（可以理解为症候归纳阶段）、预测中药集合阶段（处方）



   













