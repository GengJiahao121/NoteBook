# 博士论文研究一：基于多图卷积网络的证候感知的药方推荐
总体上来说：
1. 具体地，模型根据症状在处方中的**共现频率**构建了症状-症状图，然后采用图卷积操作从中提取到症状表示rs。类似地，模型从中药-中药图中学习到中药表示rh

2. 这里的症状-症状图和中药-中药图是所有症状和中药吗？是的，是所有的处方中的症状和中药集合，模型的目的其实是学习症状和中药的最终的融入了关系信息的表示。

## 网络模型框架

### **多图嵌入层**（三个图：症状-症状，中药-中药，中药-症状）

为**所有症状S**和**所有中药H**中学习到全面的**向量化表示**（可以理解为是所有症状和所有中药的嵌入，嵌入之后的向量已经学习到了症状-症状，中药-中药（共现关系），症状-中药之间的关系）。

**症状和中药的初始表示是用one-hot还是什么？文中没有说，具体怎么处理，如果有必要的话还是要看论文的代码！**
[https://github.com/GengJiahao121/ICDE-2020-SMGCN.git](https://github.com/GengJiahao121/ICDE-2020-SMGCN.git)

1. 二分图卷积网络（**嵌入症状-中药关系**）
   - 构建症状-中药二部图：如果s和h在同一个处方中出现过置为1，否则为0（注意：症状和中药是**不同类型**）
   -  为了区别不同类型，学习症状用面向症状的消息传播网络 + 学习中药用面向中药的消息传播网络。可以理解为***相同模型，不同参数***。

根据二部图来进行消息的构造、聚合、再构造、再聚合（说白了就是图卷积神经网络）

2. 协同图编码（面向的是数据集中所有的处方构建**中药-中药，症状-症状图**）：模型根据症状在处方中的共现频率构建症状症状图，然后采用图卷积操作从中提取到症状表示rs。同理学习到中药表示rh。
   - 构建协同图
        
        以中药-中药协同图的构建为例，计算处方集合P中所有中药对的频率，如果中药hm和中药hn同时出现在中药集合hc中，则(hm,hn)的共现频次加1，按照上述计数规则得到中药中药频次矩阵后，本节设置超参数阈值xh来过滤矩阵项。具体地，对于在处方中共现超过xh次的中药对，对应的矩阵项设为1，否则设为0。

   - 消息传播（采用单层图卷积网络处理协同图得到症状和中药的表示）

3. 信息融合（1和2进行求和操作）

### **证候归纳层**
- 处理过程：
  1. **多热向量**表示症状集合sc，如果sc包含症状s，则相应的维度设为1，否则设为0
  2. 其次从章节3.3.3得到的e∗S∈RM×d中**查找出sc中多个症状对应的表示向量**，将这些向量**组织成矩阵es**c∈R|sc|×d；
  3. 然后采用**平均池化**操作Mean(·)来归纳矩阵esc得到单个的表示；
  4. 最后考虑到证候归纳的复杂性，本节使用非线性的**多层感知机**来处理上一步得到的单个向量**得到证候表示**

### **药方推荐**

- 证候表示向量 \* 所有的中药特征向量 -\> 维度为N的多热预测概率向量

### 自认为有哪些不足

1. ChatGPT回答如下：

在训练智能处方模型时，除了已有数据集中的症状与症状之间、症状与中药之间、中药与中药之间的关系外，还应考虑以下可利用的关系：

- 病症与**体质**之间的关系

    1. 这个有人做过了

    2. 目前找不到公开数据集

- 中药组方的配伍规律：在训练智能处方模型时，可以考虑中药组方的配伍规律，使模型能够生成符合中药配伍原则的处方。收集与中药组方配伍规律相关的权威资料、中医经典文献、医案等。这些资料应该包括中药的**性味归经、功效、配伍禁忌**等方面的信息。

- 中药与疾病之间的适应症关系：中药对于不同疾病具有不同的适应症，即具有特定的药理作用和治疗效果。在训练智能处方模型时，可以考虑中药与疾病之间的适应症关系，使模型能够根据疾病类型生成相应的中药处方。

   中药数据库：如TCMSP（中药系统药理学数据库）**网站已收藏**、TCMID（中药化学成分数据库）**已下载**、TCM-DSP（中药化学物质数据平台）等，这些数据库提供中药药物的化学成分、药理作用、适应症等信息。

   经典医书数据集：包括《黄帝内经》、《伤寒杂病论》、《本草纲目》等经典医书的文本数据集，可用于研究中医经典文献的内容和知识。

- 药物相互作用：中药在组方时需要考虑药物相互作用的影响，以确保处方的安全性和有效性。在训练智能处方模型时，可以考虑中药之间的相互作用关系，使模型能够避免不良的药物组合。

   以下是一些常见的药物相互作用数据集：

   DrugBank：DrugBank 是一个广泛使用的药物数据库，提供了详细的药物信息，包括药物相互作用、药物代谢途径、药物作用靶点等。可以通过 DrugBank 获取药物相互作用数据。

   SIDER：SIDER（Side Effect Resource）是一个药物副作用数据库，包含了药物副作用和药物相互作用的信息。SIDER 数据集提供了广泛的药物和副作用关联数据，可用于药物相互作用研究。

   Drug Interactions Knowledge Base：Drug Interactions Knowledge Base (DIKB) 是一个用于药物相互作用研究的数据库。它提供了大量的药物相互作用信息，包括药物之间的相互作用类型、作用机制等。

   TWOSIDES：TWOSIDES 是一个整合了多个数据库的药物副作用和相互作用数据集。它包含了来自于药品包装说明书、医疗文献和电子健康记录等多个来源的数据，可用于药物相互作用研究。

   TCMSP：TCMSP 是一个中药系统药理学数据库，提供了中药药物的化学成分、药理作用、适应症等信息。虽然它主要关注中药的药理学特性，但其中也包含了一些关于中药相互作用的数据。

   这些数据集可以通过访问相应的数据库或研究机构的网站来获取。请注意，数据集的许可和使用规定可能会有所不同，确保遵守相关的法律、规定和使用条款。

- 治疗效果与临床反馈之间的关系：通过收集患者的临床反馈和治疗效果，可以建立治疗效果与病情、处方的关系模型。这些反馈数据可以用于优化智能处方模型，提高模型的预测准确性和治疗效果。

- 病症与疾病之间的关系：中医诊断和治疗的核心是将症状与疾病联系起来，因此研究病症与疾病之间的关系对于智能处方模型非常重要。可以利用已有的医学知识、临床经验和医疗文献等，建立病症与疾病的对应关系，以便模型能够更准确地根据症状推断出患者可能的疾病。

- 中药与疾病之间的关系：中药在中医治疗中起着重要的作用。考虑中药与疾病之间的关系，可以帮助智能处方模型更好地理解中药的适应症和治疗作用。这可以基于中医经典文献、临床实践和药物研究等数据，建立中药与疾病之间的关联规则和知识图谱。

- 病程信息与治疗计划之间的关系：对于一些慢性病或复杂病症，病程信息对于制定准确的治疗计划非常重要。模型可以学习患者的病程数据，如病程的变化趋势、用药效果、治疗反应等，以便根据个体情况调整中药处方和疗程。

为了嵌入上述提到的关系，可以采用以下技术来提高模型的表现和效果：

- 知识图谱嵌入（Knowledge Graph Embedding）

- 自注意力机制（Self-Attention Mechanism）

- 图神经网络（Graph Neural Networks）

- 多模态融合（Multimodal Fusion）

- 强化学习（Reinforcement Learning）：强化学习与个性化：结合强化学习算法，通过与患者的交互来优化处方结果，并实现个性化的推荐。根据患者的反馈和病程信息，模型可以自动调整中药组合和剂量，以获得更好的治疗效果。

为了最大限度地发挥中医智能处方模型的预测能力，可以考虑以下设计要点：

- 模型架构选择

- 特征工程与嵌入

- 多模态融合

- 数据增强与模型训练：使用数据增强技术扩充训练集，以增加模型的泛化能力和鲁棒性。例如，对文本数据进行词语替换、删除、插入等操作，对图像数据进行旋转、裁剪、翻转等操作。合理设置模型的训练参数，选择适当的优化算法和损失函数，以提高模型的预测性能。

- 预测与解释性：设计模型的预测和解释性功能，使模型能够输出准确的处方预测结果，并给出相应的解释或依据。这可以帮助医生或患者理解模型的决策过程和推荐依据，增加模型的可信度和可接受性。

- 模型评估与迭代：使用合适的评估指标对模型进行评估，并进行迭代优化。根据实际应用需求和反馈，不断改进模型的性能和预测能力。

为了匹配中医的症候归纳和处方流程，可以考虑以下设计方案：

- 症候归纳模块：设计一个症候归纳模块，用于从患者描述的症状中提取关键信息。可以使用自然语言处理技术，如文本分类、实体识别等，来识别和分类症状。

- 病症与疾病关联模块：建立病症与疾病之间的关联模型，以准确推断患者可能的疾病。该模块可以利用中医经典文献、临床经验和医疗数据等资源，将病症与疾病之间的关系进行建模。可以使用知识图谱、图神经网络等方法，将病症、疾病和相关知识嵌入模型中，以获得更好的关联性推断能力。

- 中药选择模块：设计一个中药选择模块，根据患者的症状和疾病，推荐合适的中药组合。该模块可以基于中医理论、药物知识和配伍规则等，将症状与中药之间的关系进行建模。可以使用知识图谱、注意力机制等技术，将症状、疾病、中药等信息进行融合和推理，以生成准确的中药处方。

- 模型解释性：为了增加模型的解释性，可以设计一个解释模块，用于解释模型的预测结果和推荐依据。该模块可以向医生或患者提供模型的决策过程、推理路径和关键因素等信息，以帮助他们理解模型的预测结果和建议。可以使用可视化技术、推理路径分析等方法来实现模型解释性功能。

















